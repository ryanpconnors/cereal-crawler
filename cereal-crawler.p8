pico-8 cartridge // http://www.pico-8.com
version 30
__lua__
-- cereal monster
-- rougelike dungeon crawler 
-- (c)2021 thrillho

function _init()
	t=0
	start_game()
	_upd=update_game
	_drw=draw_game 
end

function _update60()
 t=(t+1)%30 --t per second
	_upd()
end

function _draw()
 _drw()
end

function start_game()
	player_init(007,010,⬆️)
end
-->8
-- updates

function update_game()
	if btnp()>0 then
		move_player()
	end
	if hp == 0 then
		_upd=update_game_over
	end
end

function update_game_over()
	return true
end
-->8
-- draws
function draw_game()
	-- clear the screen (black)
 cls(0)
 draw_map()
 draw_player()
end

function draw_game_over()
	cls(1)
end

function draw_map()
	-- draw the map at (0,0)
	map(000,000)
end
-->8
-- player

function player_init(x,y,dir)
	p={}
	p.x,p.y=nil,nil 				--position
	p.hit_x,p.hit_y=0,8 --hitbox pos
	p.hit_w,p.hit_h=7,7 --hitbox size
	p.ani={													--animations
			[⬅️]={006,007,008,007},
	 	[➡️]={006,007,008,007},
			[⬆️]={038,039,040,039},
	 	[⬇️]={022,023,024,023}
	}
	p.spr=nil  			--current sprite 
	p.frm=nil					--animation frame
	p.dir=dir 				--direction
	p.spd=8  					--speed
	p.t=0         --ani timer
	p.ox,p.oy=0,0 --ani offset
	p.dx,p.dy=0,0 --position delta 
 p.x,p.y=x*8,y*8
end

function draw_player()
	spr(get_frame(p.ani[p.dir]),p.x+p.ox,p.y+p.oy,1,1,p.dir==⬅️,false)
end

function animate_player()
 p.t=min(p.t+0.125,1)
 p.ox=p.dx*(1-p.t)
 p.oy=p.dy*(1-p.t)
 if p.t==1 then
 	_upd=update_game
 end
end

function move_player()
	local d_x={-1,1,0,0}
	local d_y={0,0,-1,1}
	for i=⬅️,⬇️ do
		if btnp(i) then
			local dx,dy=d_x[i+1],d_y[i+1]
			local dest_x,dest_y=flr((p.x/8)+dx),flr((p.y/8)+dy)
			local tile=mget(dest_x,dest_y)
			p.dir=i
			if fget(tile,0) then
			 -- wall
			else
				p.x+=dx*p.spd
				p.y+=dy*p.spd
				p.dx,p.dy=dx*-8,dy*-8
				p.ox,p.oy=p.dx,p.dy
				p.t=0
				_upd=animate_player
				return
			end
		end
	end
end

-->8
-- helpers


-- get current frame from animations array
-- where t is the gloabl frame counter
function get_frame(animations)
	slowdown=12
	return animations[flr(t/slowdown)%#animations+1]
end
__gfx__
00000000000000000000000000000000000000000000000000444400004444000044440000222200000000000000000000000000000eeeeeeee0000000000000
00000000077007700770077000000000000000000000000004f1f10004f1f10004f1f10002eeee2000000000000000000000000080e222ee222e088000000000
00700700788778877887700700000000000000000000000004ffff0004ffff0004ffff002eeeeee20000000000000000000000088eeeeeeeeeeee28000000000
00077000788888877888000700000000000000000000000000ccc00000ccc00000ccc0002edeede20000000000000000000000008eee22eee22ee80000000000
0007700078888887788800070000000000000000000000000fccf00000fccf0000cfcf002e0ee0e20000000000000000000000008ee2dd2e2dd2e80000000000
00700700078888700788007000000000000000000000000000ccc00000ccc00000ccc0002eeeeee20000000000000000000000000ee2702e2702e00000000000
0000000000788700007807000000000000000000000000000810100000101000001010002eeeeee20000000000000000000000000eee22eee22ee00000000000
00000000000770000007700000000000000000000000000000008000008080000080080020e02e0200000000000000000000000008eeeeeeeeee800000000000
07665766657666566657666056666665994444499944449900444400004444000044440000000000000000000000000000000000088ee0000ee8800000000000
60555555555555555555550765666650944444449444444904f1f140041f1f40041f1f4000000000000000000000000000000000008eeeeeeee8000000000000
65076665666576666576605666555500999999999999999904ffff4004ffff4004ffff40000000000000000000000000000000022222eeeeeee2222000000000
75605555555555555555065666555500944444449444444900cccc0000cccc0000cccc000000000000000000000000000000222dddd22eeeee22ddd222000000
5565076665766656666056566655550094444a44944a444900cccf0000fccf0000fccc000000000000000000000000000002dddddddd2222222ddddddd200000
65556055555555555506565566555500944444449444444900fccc0000cccc0000cccf00000000000000000000000000002dd00000000000000000000dd20000
65656507666657666056555765000050999999999999999900100100001001000010010000000000000000000000000000200002000000000000000000020000
75655560555555550655565650000005944444449444444900000800008008000080000000000000000000000000000000200002000000000000000000020000
65656565566666665657555500000000995555555555559900444400004444000044440000000000000000000000000000200002000000000000000000020000
55655565655555505656575600000000940000000000004904444440044444400444444000000000000000000000000000200002000000000000000000020000
65656565655555505556565600000000940000000000004904444440044444400444444000000000000000000000000000202222000000000000000000200000
65756575655555505656565600000000940000000000004900ccccf000cccc000fcccc0000000000000000000000000000220002000000000000000000200000
6555655565555550565556550000000094000000000000490fcccc0000cccc0000cccc0000000000000000000000000000222222000000000000000000200000
75657565655555505657565700000000940055555555504900cccc000fccccf000ccccf000000000000000000000000000000000000000000000022222200000
556555656555555055565556000000009405ddddddddd54900100100001001000010010000000000000000000000000000000000000000000000000000000000
65756565000000055656565600000000945666666666664900000800008008000080000000000000000000000000000000000000000000000000000000000000
65656560555555550655565600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65556506656667566057565600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
75657055555555555506555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55650667566756666650565600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65705555555555555555065500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65066566665667566756605700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70555555555555555555550600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06656756667566666567566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001010101010100000000000000000000010001000000000000000000000000000101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1011111111111114151111111111111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021211321212121212121211321212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121211313131321212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021211321211313131321211321212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021211321211313131321211321212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121211313131321212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212121212121212121212121212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3031313131313131313131313131313200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
